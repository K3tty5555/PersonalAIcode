---
name: ai-pm-story
description: >-
  用户故事编写技能。基于需求分析，编写详细的用户故事和用例。
  包括用户场景、验收标准、流程图描述等。
argument-hint: "[需求分析文件路径]"
allowed-tools: Read Write Edit Bash(mkdir)
---

# 用户故事编写

## 执行协议

- 基于需求分析结果编写用户故事
- 使用标准用户故事格式
- 每个故事都有明确的验收标准
- **开始前询问**：主动询问用户是否有特殊场景需要覆盖
- **用户确认**：生成后询问是否有遗漏的场景或特殊需求
- 按优先级和迭代规划组织

### 0. 开始前询问用户补充

**阶段启动询问：**
```
🔄 即将开始：用户故事编写

基于需求分析，我计划编写以下模块的用户故事：
• {模块1}：{简述}
• {模块2}：{简述}
• {模块3}：{简述}

💬 在开始编写前，请问：
   有什么特殊的使用场景、异常流程或边缘情况需要考虑？

例如：
• 网络异常时的处理（断网、超时）
• 用户误操作的容错（误删、误提交）
• 权限相关的限制（无权限、权限变更）
• 数据异常情况（数据丢失、数据不一致）
• 特殊的用户操作习惯
• 需要特别注意的安全问题

请直接告诉我特殊场景，或回复"没有补充，按标准编写"。
```

**处理用户补充：**
- 如果用户提及特殊场景 → 为每个场景编写对应的用户故事
- 如果用户关注异常流程 → 重点编写异常处理和边界情况
- 如果用户无补充 → 基于需求分析编写标准用户故事集

---

## 用户故事格式

**标准格式：**
```
作为 [用户角色]，
我希望 [功能/能力]，
以便 [价值/目标]。
```

**故事编号：** US-{模块}-{序号}
**优先级：** P0/P1/P2/P3
**故事点：** {估算值}

## 验收标准模板

```markdown
### 验收标准

#### 场景1：正常流程
Given [前提条件]
When [用户操作]
Then [预期结果]

#### 场景2：异常流程
Given [异常前提]
When [用户操作]
Then [错误提示/处理方式]

#### 场景3：边界情况
Given [边界条件]
When [用户操作]
Then [预期行为]
```

## 故事分类

### Epic（史诗故事）
大颗粒度的功能模块，包含多个用户故事。

### Story（用户故事）
可独立交付的功能点。

### Task（任务）
技术实现层面的具体任务。

## 输出格式

输出文件：`{项目目录}/04-user-stories.md`

**项目目录通过环境变量或参数获取：**
- 优先从 `$PROJECT_DIR` 环境变量读取
- 其次从参数读取
- 默认回退到 `./ai-pm/output/projects/default/`

```markdown
# 用户故事文档

## 1. 文档信息

**产品名称**：{产品名}
**版本**：v1.0
**创建日期**：{日期}
**状态**：{草稿/评审中/已确认}

## 2. 用户角色定义

| 角色ID | 角色名称 | 描述 | 使用频率 |
|-------|---------|------|---------|
| R01 | 普通用户 | ... | 高 |
| R02 | 管理员 | ... | 中 |

## 3. Epic 列表

### Epic 1: {模块名称}
**描述**：{模块功能概述}
**包含故事数**：{数量}
**优先级**：P0

#### 故事 US-001
**标题**：{一句话描述}

**用户故事**：
作为 [角色]，
我希望 [功能]，
以便 [价值]。

**优先级**：P0
**故事点**：3

**前置条件**：
- 条件1
- 条件2

**验收标准**：
```gherkin
场景：正常登录
Given 用户已注册账号
When 用户输入正确的用户名和密码
Then 用户成功登录系统
And 跳转至首页

场景：密码错误
Given 用户已注册账号
When 用户输入错误的密码
Then 显示"密码错误"提示
And 允许用户重新输入
```

**UI/UX 说明**：
{相关设计要点}

**技术备注**：
{技术实现注意事项}

#### 故事 US-002
{同上格式}

### Epic 2: {模块名称}
{同上结构}

## 4. 用户旅程地图

### 旅程 1: {旅程名称}

**阶段**：发现 → 注册 → 首次使用 → 持续使用 → 推荐

| 阶段 | 用户行为 | 用户想法 | 痛点 | 机会 |
|------|---------|---------|------|------|
| 发现 | ... | ... | ... | ... |
| 注册 | ... | ... | ... | ... |

## 5. 故事优先级矩阵

| 故事ID | Epic | 优先级 | 故事点 | 依赖 | 计划迭代 |
|-------|------|-------|-------|------|---------|
| US-001 | Epic1 | P0 | 3 | 无 | Sprint 1 |
| US-002 | Epic1 | P0 | 5 | US-001 | Sprint 1 |

## 6. 非功能需求

### 性能需求
- 页面加载时间 < 2s
- API 响应时间 < 500ms

### 安全需求
- 密码加密存储
- 敏感操作需要二次确认

### 兼容性需求
- 支持主流浏览器
- 移动端适配

## 7. 待澄清问题

| 序号 | 问题 | 提出人 | 状态 | 结论 |
|-----|------|-------|------|------|
| 1 | ... | ... | 待确认 | - |

## 8. 变更历史

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|---------|------|
| ... | ... | ... | ... |
```

## 执行步骤

1. 读取需求分析报告
2. 定义用户角色
3. 划分 Epic 模块
4. 编写用户故事
5. 编写验收标准
6. 规划优先级和迭代
7. 输出文档
